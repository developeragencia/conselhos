import{g as z,r as t,n as I,j as e,C as V,b as q,c as J,d as _,e as B,I as u,f as c,L as v}from"./index-C9s3gB-3.js";import{L as f}from"./label-CHUtYmr4.js";import{A as M,a as R,E as N}from"./alert-Blql91It.js";import{C as H}from"./circle-alert-BweEUIZq.js";import{E as C}from"./eye-5QI_uo9p.js";import{C as G}from"./circle-check-big-AFLFqLX2.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=z("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);function $(){const[r,x]=t.useState("email"),[d,S]=t.useState(""),[p,b]=t.useState(""),[m,P]=t.useState(""),[g,E]=t.useState(""),[j,D]=t.useState(!1),[w,T]=t.useState(!1),[o,l]=t.useState(!1),[y,s]=t.useState(""),[i,F]=t.useState(null),{toast:L}=I(),k=async a=>{if(a.preventDefault(),!d){s("Por favor, informe seu e-mail");return}l(!0),s("");try{const n=await(await fetch("/api/auth/verify-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d})})).json();n.success?(F(n.cpfInfo),x("cpf")):s(n.message||"E-mail não encontrado")}catch{s("Erro ao verificar e-mail. Tente novamente.")}finally{l(!1)}},A=async a=>{if(a.preventDefault(),!p||p.length!==3){s("Por favor, informe os 3 dígitos do CPF");return}l(!0),s("");try{(await(await fetch("/api/auth/verify-cpf-digits",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d,digits:p,type:i==null?void 0:i.type})})).json()).success?x("newPassword"):s("Dígitos do CPF incorretos. Tente novamente.")}catch{s("Erro ao verificar CPF. Tente novamente.")}finally{l(!1)}},O=async a=>{if(a.preventDefault(),!m||m.length<6){s("A senha deve ter pelo menos 6 caracteres");return}if(m!==g){s("As senhas não coincidem");return}l(!0),s("");try{const n=await(await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d,newPassword:m})})).json();n.success?(x("success"),L({title:"Senha alterada com sucesso!",description:"Você já pode fazer login com sua nova senha."})):s(n.message||"Erro ao alterar senha")}catch{s("Erro ao alterar senha. Tente novamente.")}finally{l(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 via-white to-gold-50 px-4",children:e.jsxs(V,{className:"w-full max-w-md",children:[e.jsxs(q,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"w-10 h-10 text-purple-600"})}),e.jsx(J,{className:"text-2xl font-bold text-purple-800",children:"Recuperar Senha"}),e.jsxs(_,{children:[r==="email"&&"Informe seu e-mail para recuperar a senha",r==="cpf"&&"Confirme sua identidade",r==="newPassword"&&"Defina sua nova senha",r==="success"&&"Senha alterada com sucesso!"]})]}),e.jsxs(B,{className:"space-y-4",children:[y&&e.jsxs(M,{variant:"destructive",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx(R,{children:y})]}),r==="email"&&e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"email",children:"E-mail"}),e.jsx(u,{id:"email",type:"email",value:d,onChange:a=>S(a.target.value),placeholder:"seu@email.com",required:!0})]}),e.jsx(c,{type:"submit",className:"w-full",disabled:o,children:o?"Verificando...":"Continuar"})]}),r==="cpf"&&i&&e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{htmlFor:"cpfDigits",children:["Digite os ",i.type==="first"?"primeiros":"últimos"," 3 dígitos do seu CPF"]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:["CPF: ",i.type==="first"?"___":"***.***.***-",i.digits]}),e.jsx(u,{id:"cpfDigits",type:"text",value:p,onChange:a=>b(a.target.value.replace(/\D/g,"").slice(0,3)),placeholder:"123",maxLength:3,required:!0})]}),e.jsx(c,{type:"submit",className:"w-full",disabled:o,children:o?"Verificando...":"Confirmar"})]}),r==="newPassword"&&e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"newPassword",children:"Nova Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{id:"newPassword",type:j?"text":"password",value:m,onChange:a=>P(a.target.value),placeholder:"Mínimo 6 caracteres",required:!0}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>D(!j),children:j?e.jsx(N,{className:"h-4 w-4"}):e.jsx(C,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{id:"confirmPassword",type:w?"text":"password",value:g,onChange:a=>E(a.target.value),placeholder:"Confirme a senha",required:!0}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>T(!w),children:w?e.jsx(N,{className:"h-4 w-4"}):e.jsx(C,{className:"h-4 w-4"})})]})]}),e.jsx(c,{type:"submit",className:"w-full",disabled:o,children:o?"Alterando...":"Alterar Senha"})]}),r==="success"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"w-8 h-8 text-green-600"})}),e.jsx("p",{className:"text-green-600 font-medium",children:"Sua senha foi alterada com sucesso!"}),e.jsx(v,{href:"/login",children:e.jsx(c,{className:"w-full",children:"Fazer Login"})})]}),e.jsx("div",{className:"text-center pt-4",children:e.jsx(v,{href:"/login",className:"text-sm text-purple-600 hover:underline",children:"Voltar para o login"})})]})]})})}export{$ as default};
